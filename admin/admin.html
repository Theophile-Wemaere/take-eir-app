<!DOCTYPE html>

<head>
  <title>health-eir</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="/CSS/styles.css" />
  <link rel="stylesheet" href="/CSS/admin.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/images/logo-notext.png" type="image/icon type" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <script src="/JS/scripts.js"></script>
  <link
    rel="stylesheet"
    href="https://kit.fontawesome.com/bc424452bc.css"
    crossorigin="anonymous"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Krona+One&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&family=Nunito&display=swap"
    rel="stylesheet"
  />
</head>

<html>
  <body>
    <div class="top-bar">
      <div class="top-bar-img">
        <a href="/"><img src="/images/logo-notext.png" /></a>
      </div>
      <div class="right-items">
        <a href="/produit.html">
          <button class="page-button" style="margin-right: 10px">
            Notre produit
          </button></a
        >
        <div class="separator" style="margin-right: 10px"></div>
        <a href="/presentation.html">
          <button class="page-button" style="margin-right: 10px">
            Qui sommes nous ?
          </button></a
        >
        <a href="/login.php">
          <button class="login-button" style="margin-right: 10px">
            Se connecter
          </button></a
        >
      </div>
      <span style="pointer-events: auto">
        <div
          class="menu-button"
          href="javascript:void(0);"
          onclick="toggleMenu()"
        >
          <div class="sphere" style="background-color: #2d67e0"></div>
          <div class="sphere" style="background-color: #e0584c"></div>
          <div class="sphere" style="background-color: #5dd1b7"></div>
        </div>
      </span>
    </div>
    <div class="drop-menu" id="dropMenu" style="display: none">
      <a href="/produit.html"
        ><button class="page-button">Notre produit</button></a
      >
      <div class="separator"></div>
      <a href="/presentation.html"
        ><button class="page-button">Qui sommes nous ?</button></a
      >
      <div class="separator"></div>
      <a href="/login.php"
        ><button class="login-button" style="margin-top: 10px">
          Se connecter
        </button></a
      >
    </div>
    <div class="wrapper">
      <div class="main-box">
        <script>
          function doSearch() {
            // (A1) GET SEARCH TERM
            var data = new FormData(document.getElementById("mySearch"));

            // (A2) AJAX - USE HTTP:// NOT FILE://
            fetch("/admin-controller.php", {
              method: "POST",
              body: data,
            })
              .then((res) => res.json())
              .then((res) => {
                if (res !== null) {
                  const table = document.createElement("table");
                  const thead = table.createTHead();
                  const row = thead.insertRow();
                  row.innerHTML =
                    "<th>ID</th><th>Name</th><th>Surname</th><th>Email</th><th>Role</th><th>Created At</th><th>Action</th>";
                  const tbody = table.createTBody();
                  for (let r of res) {
                    const newRow = tbody.insertRow();
                    newRow.insertCell().textContent = r.id_user;
                    newRow.insertCell().textContent = r.name;
                    newRow.insertCell().textContent = r.surname;
                    newRow.insertCell().textContent = r.email;
                    newRow.insertCell().textContent = r.role_name;
                    newRow.insertCell().textContent = r.created_at;
                    const selectCell = newRow.insertCell();
                    const select = document.createElement("select");
                    select.innerHTML =
                      "<option value=''>Select Action</option><option value='delete'>Delete</option><option value='disable'>Disable</option>";
                    selectCell.appendChild(select);
                    const buttonCell = newRow.insertCell();
                    const button = document.createElement("button");
                    button.textContent = "Execute";
                    button.disabled = true;
                    buttonCell.appendChild(button);
                    select.addEventListener("change", function () {
                      const selectedOption = this.value;
                      if (selectedOption !== "") {
                        button.disabled = false;
                      } else {
                        button.disabled = true;
                      }
                    });
                    button.addEventListener("click", function () {
                      const selectedOption = select.value;
                      const id = r.id_user;
                      const confirmMessage = `Are you sure you want to ${selectedOption} user ${id}?`;
                      if (confirm(confirmMessage)) {
                        const url = "/admin-controller.php";
                        const data = new FormData();
                        data.append("action", selectedOption);
                        data.append("id_user", id);
                        fetch(url, {
                          method: "POST",
                          body: data,
                        })
                          .then((res) => res.json())
                          .then((res) => {
                            // Handle response from server
                            console.log(res);
                          })
                          .catch((error) => {
                            console.error(error);
                          });
                      }
                    });
                  }
                  results.appendChild(table);
                }
              });

            return false;
          }
        </script>

        <!-- (B) SEARCH FORM -->
        <form id="mySearch" onsubmit="return doSearch()">
          <input type="text" name="search" required />
          <input type="submit" value="Search" />
        </form>

        <!-- (C) SEARCH RESULTS -->
        <div id="results"></div>
      </div>
    </div>
    <div class="bottom-bar">
      <a>Â© take-eir</a>
      <a href="/contact/contact.php">Nous contacter</a>
      <div class="medias">
        <!-- https://icons8.com/icons/set/social-media -->
        <a href="https://linkedin.com/"
          ><img src="/images/icons8-linkedin-24.png" />
        </a>
        <a href="https://youtube.com/"
          ><img src="/images/icons8-youtube-logo-24.png"
        /></a>
        <a href="https://twitter.com/"
          ><img src="/images/icons8-twitter-24.png" />
        </a>
        <a href="https://instagram.com/"
          ><img src="/images/icons8-instagram-24.png" />
        </a>
      </div>
    </div>
  </body>
</html>
